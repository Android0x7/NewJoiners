function floorPlansReserveVM(n){function a(n){var o="data:image/png;base64,"+n.image,t=$('<img src="data:image/png;base64,'+n.image+'" />')[0],s="data:image/png;base64,"+n.SecondaryImage,i=$('<img src="data:image/png;base64,'+n.SecondaryImage+'" />')[0],r=t.naturalHeight,u=t.naturalWidth,f=i.naturalHeight,e=i.naturalWidth,h;return n.imageType=="svg"&&(o="data:image/svg+xml;base64,"+n.image,t=$('<img src="'+o+'" />')[0],r=t.naturalHeight,u=t.naturalWidth,(!r||r>100)&&(r=100),(!u||u>100)&&(u=100),t=$('<img src="'+o+'" height="'+r+'" width="'+u+'" />')[0]),n.secondaryImageType=="svg"&&(s="data:image/svg+xml;base64,"+n.SecondaryImage,i=$('<img src="'+s+'" />')[0],f=i.naturalHeight,e=i.naturalWidth,(!f||f>100)&&(f=100),(!e||e>100)&&(e=100),i=$('<img src="'+s+'" height="'+f+'" width="'+e+'" />')[0]),h={id:n.id,FloorPlanIndicatorID:n.id,image:o,imageObj:t,height:r,width:u,SecondaryImage:s,secondaryImageObj:i,secondaryHeight:f,secondaryWidth:e},$.extend(n,h),n}function g(n){if(i.fileFormat=n.extension.replace(".",""),i.imageWidth=n.width,i.imageHeight=n.height,i.imageHeight===0||i.imageWidth===0)throw"error getting diagram details";var t=' width="'+i.imageWidth+'px" height="'+i.imageHeight+'px"';i.imgSrc=i.fileFormat==="svg"?"data:image/svg+xml;base64,"+n.image:"data:image/"+i.fileFormat+";base64,"+n.image,i.imgObj='<img src="'+i.imgSrc+'" '+t+" />"}function nt(n,t,r,u,f){return vems.ajaxPost({url:vems.serverApiUrl()+"/GetFloormapAvailabilityList",data:JSON.stringify({ImageId:n,BuildingId:t,searchData:u,filterData:{filters:f}}),success:function(u){var e,f,c,o,s,h;i.rooms=ko.observableArray([]),e=JSON.parse(u.d),e&&(e.Indicators&&(o=[],$.each(e.Indicators,function(n,t){var i=a(t);o.push(i)}),i.Indicators(o)),e.Rooms&&(f=[],c=[],r>0?(o=$.grep(e.Rooms,function(n){return n.RoomId==r}),$.isArray(o)&&o.length>0&&(s=y(o[0]),f.push(s))):$.each(e.Rooms,function(n,t){var i=y(t);f.push(i)}),(!n||n<=0)&&t&&t&&f.length>0&&i.roomFloorInfo.FloorMapID(f[0].FloorMapID()),$("#favorites-only-chk").prop("checked")&&(h=f.filter(function(n){return n.Favorite===!0}),f=h),i.rooms(f)))}})}function y(n){var t=new FloorMapRoomInfo;return t.RoomID(n.RoomId),t.RoomId(n.RoomId),t.RoomCode(n.RoomCode),n.RoomDescription&&t.RoomDescription(n.RoomDescription),t.Available(n.available),t.XCoord(n.XCoord),t.YCoord(n.YCoord),t.RoomType(-1),n.RoomTypeDescription&&n.RoomTypeDescription.length>0&&t.RoomTypeDescription(n.RoomTypeDescription),t.RecordType(n.RecordType),t.Available(n.UnavailableReason>0?!1:!0),t.AllowReservation(n.UnavailableReason>0?!1:!0),t.UnavailableReason(n.UnavailableReason),t.FloorPlanIndicatorID(n.FloorPlanIndicatorID),t.FloorMapID(n.ImageID),n.OffsetMinutes&&(t.OffsetMinutes=ko.observable(n.OffsetMinutes)),$.extend(n,t),n}function tt(){i.isPhone()&&(L_DISABLE_3D=!0,e=$("#map").parent().width()-10)}function p(n,t){return{type:"Feature",geometry:{coordinates:[parseInt(n),parseInt(t)],type:"Point"},properties:{}}}function h(n){var t="map",r,u,f;if(i.isPhone()&&(L_DISABLE_3D=!0,e=380,v=375),i.renderType=="modal"){t=i.isPhone()?"mobile-modal-map":"modal-map",r=$("#floormap-modal"),$(r).find(".modal-title").html(i.roomFloorInfo.RoomDescription()),u=$("#floormap-modal .modal-dialog"),f=$("#floormap-modal .modal-content"),i.sizeModal(r,u,f);r.modal("show").off("shown.bs.modal").on("shown.bs.modal",function(){w(t,n)}).off("hidden.bs.modal").on("hidden.bs.modal",function(){it()})}else i.isPhone()&&tt(),w(t,n)}function it(){var n=$(r.getContainer());n.empty()}function w(n,t){var e,nt,it,w,ft,g;if(i.imgSrc.length!==0){if(e=$(i.imgObj)[0],nt={height:e.naturalHeight===0?e.height:e.naturalHeight,width:e.naturalWidth===0?e.width:e.naturalWidth},r)try{r.remove()}catch(et){}u=$("#"+n),o=!1,s=null,r=L.map(n,{attributionControl:!1,maxZoom:4,minZoom:-4,zoom:0,crs:L.CRS.Simple}),f=k(nt,r.getZoom()),c=L.imageOverlay(i.imgSrc,f),c.addTo(r),t&&t().length>0?(it=[],o=t().length==1,$.each(t(),function(n,t){var f=p(t.XCoord(),t.YCoord()),u=d(f,r,t,i.precheckIconAvailability());u.addTo(r),o===!0&&(s=u)})):(w=d(i.indicatorCoords,r,i.roomFloorInfo,i.precheckIconAvailability()),w.addTo(r),o=!0,s=w);$(r.zoomControl._zoomInButton).on("click",function(){var t=r.getZoom(),i=r.getMaxZoom();t<i&&r.setZoom(t+1)});$(r.zoomControl._zoomOutButton).on("click",function(){var t=r.getZoom(),i=r.getMinZoom();t>i&&r.setZoom(t-1)});ft=u.height(),i.initialContainerWidth===0&&(i.initialContainerWidth=u.width());var v=i.initialContainerWidth,l=Math.max(document.documentElement.clientHeight,window.innerHeight||0)-75,a=0,h=0,tt=e.naturalHeight===0?e.height:e.naturalHeight,y=e.naturalWidth===0?e.width:e.naturalWidth;if(y>v){if(!i.isPhone()||i.renderType=="modal")r.on("zoomend",b);g=Math.floor(Math.ceil(y/v)/-2),a=Math.round(y/v),h=tt/a,h>l?(u.height(l),r.setZoom(g+(h-l>200?0:1))):(u.height(h),r.setZoom(g+1)),r.invalidateSize()}else a=Math.round(v/y),h=tt*a,h>l?(u.height(l),r.setZoom(a-(h-l>200?2:1))):(u.height(h),r.setZoom(a-1)),r.invalidateSize();r.fitBounds(f),i.renderType==="modal"&&rt(),$(".leaflet-marker-icon").css("cursor","pointer"),ut()}}function b(){r.off("zoomend",b),r.invalidateSize(!0)}function rt(){o===!0&&s&&!i.isPhone()?($("body").scrollTo($(".leaflet-container"),{duration:"slow"}),s.getLayers()[0].openPopup()):r.setMaxBounds(f)}function ut(){var n=new L.Control({position:"bottomright"});n.onAdd=function(){var t=L.DomUtil.create("a","resetzoom");return t.innerHTML="[Reset Zoom]",$(t).css("cursor","pointer"),L.DomEvent.disableClickPropagation(t).addListener(t,"click",function(){i.closeActivePopupAndReset()},t),t},n.addTo(r)}function ft(){var n={height:c._image.height,width:c._image.width};f=k(n,r.getZoom()),r.fitBounds(f),r.setMaxBounds(f)}function k(n,t){var i=r.unproject([0,n.height],t),u=r.unproject([n.width,0],t);return new L.LatLngBounds(i,u)}function d(n,t,r,u){var o,s,e,f,h=$.grep(i.Indicators(),function(n){return parseInt(n.FloorPlanIndicatorID)==parseInt(r.FloorPlanIndicatorID())}),v,c,y,p;return $.isArray(h)&&h.length>0?f=h[0]:(console.log("Indicator is no longer associated with this floormap. The Floormap Indicator may have been removed from the Floormap in the EMS Client."),v={id:parseInt(r.FloorPlanIndicatorID()),image:l,imageType:"png",SecondaryImage:l,secondaryImageType:"png"},f=a(v)),i.bookings&&i.bookings().length>0&&(c=$.grep(i.bookings(),function(n){return n.RoomId()==r.RoomID()}),$.isArray(c)&&c.length>0&&r.Available(!1)),o=f.imageObj,s=f.height,e=f.width,u&&i.loadRoomAvailability(r,!1).success(function(n){var u=[],t=moment(new Date),i;n.childNodes.length>0&&n.childNodes[0].firstChild&&n.childNodes[0].firstChild.data&&(u=JSON.parse(n.childNodes[0].firstChild.data)),i=t.utcOffset(),$.each(u,function(n,u){t>moment(u.gmtstarttime).add(i,"minutes")&&t<moment(u.gmtendtime).add(i,"minutes")&&r.Available(!1)})}),r.Available()||(o=f.secondaryImageObj,s=f.secondaryHeight,e=f.secondaryWidth),y=new L.icon({iconUrl:$(o).attr("src"),iconSize:[e,s],iconAnchor:[25,0],popupAnchor:[e/2-25,0]}),p=new L.GeoJSON(n,{pointToLayer:function(n,t){return et(y,r,t)}}),p}function et(n,t,u){var f=L.marker(r.unproject([u.lng,u.lat],0),{icon:n});f.bindPopup("Loading...",{keepInView:!0});f.on("popupclose",i.closePopupHandler);f.on("popupopen",function(n){var u=n.target.getPopup();r.setMaxBounds(!1),i.loadRoomAvailability(t).success(function(n){var i=[],r;n.childNodes.length>0&&n.childNodes[0].firstChild&&n.childNodes[0].firstChild.data&&(i=JSON.parse(n.childNodes[0].firstChild.data)),r=ot(t,i),u.setContent(r),u.update()})});return f}function ot(n,t){var s=n.Available(),u="",h=moment(new Date),f,e,r,o,c;return t&&t.length>0&&(u=$("<table class='table-striped table-condensed'>"),f=$("<thead>"),f.append($("<th>").append(i.ScreenText.StartTimeText)),f.append($("<th>").append(i.ScreenText.EndTimeText)),f.append($("<th>").append(i.ScreenText.TitleText)),f.append($("<th>").append(i.ScreenText.GroupNameText)),f.appendTo(u),e=$("<tbody>"),$.each(t,function(n,t){var i=$("<tr>");i.append($("<td>").append(moment(t.starttime).format("MMMM Do YYYY LT"))),i.append($("<td>").append(moment(t.endtime).format("MMMM Do YYYY LT"))),i.append($("<td>").append(t.eventname)),i.append($("<td>").append(t.groupname)),e.append(i),h>moment(t.starttime)&&h<moment(t.endtime)&&(s=!1)}),u.append(e),u=$("<div>").append(u).html()),r=$("<div>").html("<h4>"+i.ScreenText.RoomDetailsText+'<\/h4><div><span style="font-weight:bold">'+i.ScreenText.RoomCodeText+":<\/span> "+n.RoomCode()+"<\/div>"),r.append($('<div><span style="font-weight:bold">'+i.ScreenText.RoomDescriptionText+":<\/span> "+n.RoomDescription()+"<\/div>")),n.RoomTypeDescription&&n.RoomTypeDescription().length>0&&r.append($('<div><span style="font-weight:bold">'+i.ScreenText.RoomTypeText+":<\/span> "+n.RoomTypeDescription()+"<\/div>")),s?r.append($('<div><span style="font-weight:bold">'+i.ScreenText.AvailabilityText+':<\/span> <span class="floormap-available">'+i.ScreenText.AvailableText+"<\/span><\/div>")):r.append($('<div><span style="font-weight:bold">'+i.ScreenText.AvailabilityText+':<\/span> <span class="floormap-unavailable">'+i.ScreenText.UnavailableText+"<\/span><\/div>")),n.AllowReservation()&&n.Available()&&(o=n.RecordType()==1?i.ScreenText.ReserveText:i.ScreenText.RequestText,c=i.renderType=="modal"?"vems.floorPlanModalVM":"vems.floorPlanVM",n.ReservationSummaryUrl&&n.ReservationSummaryUrl().length>0?r.append($('<button class="btn btn-success" style="margin: 8px 8px 0 0;" type="button" onclick="window.location.href=\''+n.ReservationSummaryUrl()+"';\">"+o+"<\/button>")):r.append($('<button class="btn btn-success" style="margin: 8px 8px 0 0;" type="button" onclick="'+c+".roomAddedClicked("+n.RoomID()+');">'+o+"<\/button>"))),r.append(u),$("<div>").append(r).html()}var i=this,l,e,v,r,c,u,o,s,f;i.roomFloorInfo=n.RoomInfo,i.imgSrc="",i.imgObj="",i.availableIndicatorSrc="",i.unavailableIndicatorSrc="",i.availableIndicatorObj={},i.unavailableIndicatorObj={},i.Indicators=ko.observableArray([]),i.filterData=ko.observableArray([]),i.filterValues=ko.observableArray([]),i.startTime=moment(new Date),i.endTime=moment(new Date),i.initialContainerWidth=0,i.imageHeight=0,i.imageWidth=0,i.indicatorCoords,i.fileFormat="",i.rooms=ko.observableArray([]),i.buildings=ko.observableArray([]),i.isPhone=ko.observable(DevExpress.devices.real().phone),i.precheckIconAvailability=ko.observable(!1),i.bookings=n.bookings?n.bookings:ko.observableArray([]),i.renderType=n.renderType?n.renderType:"inline",l="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",n.ScreenText&&n.ScreenText.RoomCodeText&&n.ScreenText.ReserveText&&n.ScreenText.RequestText&&n.ScreenText.RoomDetailsText&&n.ScreenText.RoomDescriptionText&&n.ScreenText.RoomTypeText&&n.ScreenText.AvailabilityText&&n.ScreenText.AvailableText&&n.ScreenText.UnavailableText?i.ScreenText=n.ScreenText:console.error("screen text items required in ScreenText object: RoomCodeText, RoomDescriptionText, RoomTypeText, AvailabilityText, AvailableText, UnavailableText, ReserveText, RequestText, RoomDetailsText"),i.closeModal=function(){var n=$("#floormap-modal");$(n).modal("hide")},i.roomAddedClicked=function(t){if(n.addRoomClicked){i.closeModal();var r=$.grep(i.rooms(),function(n){return n.RoomID()==t});$.isArray(r)&&r.length>0?n.addRoomClicked(r[0]):n.addRoomClicked(i.roomFloorInfo)}},i.FloorMapWebserviceUrlComputed=function(){var n="";return i.roomFloorInfo.FloorMapWebserviceUrl&&(n=i.roomFloorInfo.FloorMapWebserviceUrl().toLowerCase(),n=n.replace("?wsdl",""),n.endsWith("/")||(n=n+"/")),n},i.refreshMap=function(n){i.bookings=n,i.renderType==="inline"?i.buildAvailabilityMap(i.roomFloorInfo,i.filterData(),i.filterValues()):i.buildModalMapForRoom(i.roomFloorInfo)},i.buildModalMapForRoomNoFilters=function(n,t,r){n&&(i.roomFloorInfo=n),t&&(i.startTime=moment(t)),r&&(i.endTime=moment(r)),i.GetDiagram().done(function(){i.getRoomIndicators().done(function(){i.getRoomIndicatorsCoord().done(function(){h()})})})},i.buildModalMapForRoom=function(n,t,r){n&&(i.roomFloorInfo=n),r&&i.filterValues(r),t&&i.filterData(t),i.GetDiagram().done(function(){i.getRoomIndicators().done(function(){i.getRoomIndicatorsCoord().done(function(){h()})})})},i.getRoomsForMap=function(n,t){n&&(i.roomFloorInfo=n);var r=$.grep(t,function(n){return n.FloorMapID()==i.roomFloorInfo.FloorMapID()});i.GetDiagram().done(function(){i.getRoomIndicators().done(function(){h(r)})})},i.buildAvailabilityMap=function(n,t,r,u,f){if(t&&t.Start)i.filterValues(r),i.filterData(t);else return!1;n&&(i.roomFloorInfo=n),u||(u=-1),f||(f=-1),nt(n.FloorMapID(),u,f,t,r).done(function(){i.GetDiagram().done(function(){i.getRoomIndicators().done(function(){h(i.rooms)})})})},i.GetDiagram=function(){var t=i.FloorMapWebserviceUrlComputed()+"GetDiagramDetails",r={imageId:i.roomFloorInfo.FloorMapID(),server:null,database:null,token:i.roomFloorInfo.FloorMapHash()};return $.ajax({type:"POST",url:t,data:r,dataType:"xml",contentType:"application/x-www-form-urlencoded",success:function(n){var t,i;n.childNodes.length>0&&n.childNodes[0].firstChild&&n.childNodes[0].firstChild.data?(t=JSON.parse(n.childNodes[0].firstChild.data),t&&(i={extension:t.results.parent[0].extension,width:t.results.parent[0].width,height:t.results.parent[0].height,image:t.results.parent[0].image},g(i))):console.log("No diagram exists for the query.")}})},i.loadRoomAvailability=function(n,t){var o=i.FloorMapWebserviceUrlComputed()+"LoadRoomAvailability",r=moment(new Date),u=r.startOf("day"),f=r.endOf("day"),e;return n.LocalStart?(u=n.LocalStart,f=n.LocalEnd):(i.filterData()&&i.filterData().Start?(r=i.filterData().Start,i.filterData().Dates&&i.filterData().Dates.length>0&&(r=moment(i.filterData().Dates[0])),u=moment(new Date(r.year(),r.month(),r.date(),moment(i.filterData().Start).hour(),moment(i.filterData().Start).minute(),0)),f=moment(new Date(r.year(),r.month(),r.date(),moment(i.filterData().End).hour(),moment(i.filterData().End).minute(),0))):i.startTime&&i.endTime&&(r=moment(i.startTime).startOf("day"),u=moment(new Date(r.year(),r.month(),r.date(),i.startTime.hour(),i.startTime.minute(),0)),f=moment(new Date(r.year(),r.month(),r.date(),i.endTime.hour(),i.endTime.minute(),0))),u=u.format("YYYY-MM-D HH:mm:ss"),f=f.format("YYYY-MM-D HH:mm:ss")),e={startDate:u,endDate:f,roomId:n.RoomID(),server:null,database:null,token:i.roomFloorInfo.FloorMapHash()},$.ajax({type:"POST",url:o,async:t!="undefined"?t:!0,data:e,dataType:"xml",contentType:"application/x-www-form-urlencoded"})},i.getRoomIndicators=function(){var n=i.FloorMapWebserviceUrlComputed()+"GetRoomIndicators",t={imageId:i.roomFloorInfo.FloorMapID(),server:null,database:null,token:i.roomFloorInfo.FloorMapHash()};return $.ajax({type:"POST",url:n,data:t,dataType:"xml",contentType:"application/x-www-form-urlencoded",success:function(n){var t=JSON.parse(n.childNodes[0].firstChild.data),r;t&&t.length>0&&(r=[],$.each(t,function(n,t){var i={id:t.id,image:t.image,imageType:t.imageType,SecondaryImage:t.secondaryimage,secondaryImageType:t.secondaryImageType},u=a(i);r.push(u)}),i.Indicators(r))}})},i.getRoomIndicatorsCoord=function(){var n=i.FloorMapWebserviceUrlComputed()+"GetRoom",t={imageId:i.roomFloorInfo.FloorMapID(),roomId:i.roomFloorInfo.RoomID(),server:null,database:null,token:i.roomFloorInfo.FloorMapHash()};return $.ajax({type:"POST",url:n,data:t,dataType:"xml",contentType:"application/x-www-form-urlencoded",success:function(n){var r=n.childNodes[0].firstChild.data,t;r=r.replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t"),t=JSON.parse(r)[0],i.indicatorCoords=p(t.xcoord,t.ycoord),t.FloorPlanIndicatorID&&i.roomFloorInfo.FloorPlanIndicatorID(t.FloorPlanIndicatorID),t.image&&(i.availableIndicatorSrc=t.image),t.SecondaryImage&&(i.unavailableIndicatorSrc=t.SecondaryImage)}})},e=800,v=600,i.sizeModal=function(n,t,r){var c=navigator.platform==="iPhone"||navigator.platform==="iPod",o=Math.floor((Math.max(document.documentElement.clientWidth,window.innerWidth||0)-e)/2),s,h,l;i.isPhone()&&(o=10),s=Math.max(document.documentElement.clientHeight,window.innerHeight||0)-o,h=Math.max(document.documentElement.clientWidth,window.innerWidth||0)-o,c&&(s=s-30),l=h>s,e=h-o-15,v=s-o-15,r.css("width",function(){return h-o}),t.css("width",function(){return h-o})},i.closeActivePopupAndReset=function(){var n=!1;$.each(r._layers,function(t){if(r._layers[t].feature){var i=this.getPopup();i.isOpen()&&(r._layers[t].closePopup(),n=!0)}}),n||ft()},i.closePopupHandler=function(){},i.mapClickHandler=function(n){var u=n.target,t=$('<img src="'+i.availableIndicatorSrc+'" />')[0],f=t.naturalHeight,r=t.naturalWidth,e=new L.icon({iconUrl:i.availableIndicatorSrc,iconSize:[r,f],iconAnchor:[25,0],popupAnchor:[r/2-25,0]}),o=new L.Marker(n.latlng,{draggable:!0,icon:e});u.addLayer(o)}}function FloorMapRoomInfo(){var n=this;n.FloorMapID=ko.observable(0),n.ImageHeight=ko.observable(0),n.ImageWidth=ko.observable(0),n.FloorMapHash=ko.observable(""),n.Floor=ko.observable(""),n.BuildingId=ko.observable(0),n.FloorId=ko.observable(0),n.FloorPlanIndicatorID=ko.observable(0),n.FloorMapWebserviceUrl=ko.observable(""),n.RoomId=ko.observable(0),n.RoomID=ko.observable(0),n.RoomTitle=ko.observable(""),n.RoomCode=ko.observable(""),n.RoomDescription=ko.observable(""),n.BuildingDescription=ko.observable(""),n.RoomTypeDescription=ko.observable(""),n.RoomType=ko.observable(-1),n.RecordType=ko.observable(1),n.AllowReservation=ko.observable(!1),n.Available=ko.observable(!0),n.UnavailableReason=ko.observable(""),n.XCoord=ko.observable(0),n.YCoord=ko.observable(0),n.ReservationSummaryUrl=ko.observable(""),n.OffsetMinutes=null}function getEventsForDay(n){if(vems.home.viewModels.myBookings&&vems.home.viewModels.myBookings.gettingEventsForDay()){vems.home.viewModels.myBookings.overflowDate(n),vems.home.viewModels.myBookings.currentDailyDate=n;return}var t=moment(n),i=t.year()+"-"+(t.month()+1)+"-"+t.date();vems.home.viewModels.myBookings.gettingEventsForDay(!0),vems.ajaxPost({url:vems.serverApiUrl()+"/SetMyRequestDataVar",data:"{date : '"+i+"'}"}).success(function(i){var r=JSON.parse(i.d),u=r.NextBookingDate===null?null:moment(r.NextBookingDate),f=vems.home.viewModels.myBookings.selectedTab()===0?"LL":"MMMM YYYY";$("#sliderContainer").data("ems_calendarScroller")&&n==vems.home.viewModels.myBookings.nextBookingDate()&&$("#sliderContainer").data("ems_calendarScroller").setDate(n),vems.home.viewModels.myBookings.gettingEventsForDay(!1),vems.home.viewModels.myBookings.events(r.EventData[0].Events),vems.home.viewModels.myBookings.currentDailyDate=t,vems.home.viewModels.myBookings.localeDate(t.format(f)),vems.home.viewModels.myBookings.nextBookingDate(u),vems.home.viewModels.myBookings.userTimeZone(r.UserTimeZone),vems.home.viewModels.myBookings.userTimeZoneAbbr(r.UserTimeZoneAbbr),DevExpress.devices.real().phone||vems.home.buildDatePicker(),$("#sliderContainer").data("ems_calendarScroller")&&$("#sliderContainer").data("ems_calendarScroller").setLock(!1),vems.home.viewModels.myBookings.overflowDate()!==null&&(getEventsForDay(vems.home.viewModels.myBookings.overflowDate()),vems.home.viewModels.myBookings.overflowDate(null)),$(".events-loading-overlay").fadeOut()}).error(function(){vems.home.viewModels.myBookings.gettingEventsForDay(!1),window.location.reload(!0)})}function buildFloorMapRoomInfo(n){var t=new FloorMapRoomInfo;return n.Floor&&t.Floor(n.Floor()),t.FloorMapID(n.ImageId()),t.RoomID(n.RoomId()),t.RoomCode(n.RoomCode()),t.RoomDescription(n.Location()),n.RoomType&&t.RoomType(n.RoomType()),t.FloorMapHash(FloorMapHash),t.FloorMapWebserviceUrl(FloorMapWebServiceUrl),t.ImageWidth(n.ImageWidth()),t.ImageHeight(n.ImageHeight()),n.ReservationSummaryUrl&&t.ReservationSummaryUrl(n.ReservationSummaryUrl),t}var vems=vems||{};vems.home=vems.home||{},vems.home.viewModels=vems.home.viewModels||{},vems.home.colorPalette=["#b5c6de","#375581","#142a4b","#6881a5","#809CC7","#e9ecf1","transparent"],vems.home.hoverColorPalette=["#cfe0f8","#516f9b","#2e4465","#829bbf"],vems.home.getBookingCounts=function(n){var t=new Date(n.getFullYear(),n.getMonth(),n.getDate());vems.ajaxPost({url:vems.serverApiUrl()+"/GetEventCountsBydate",data:"{ date : '"+n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+"' }",success:function(n){if(vems.home.bookingCounts=JSON.parse(n.d),typeof $("#bookings-monthly-calendar").data("dxCalendar")!="undefined"){$("#bookings-monthly-calendar").data("dxCalendar").repaint(),$("#bookings-monthly-calendar .dx-calendar-cell").has(".calendar-cell-weekend").css("background-color","#F2F2EA");var t=$("#bookings-monthly-calendar thead th");t.length>0&&$.each(t,function(n,t){var i=$(t);switch(i.text().toLowerCase()){case"sun":i.text(moment().isoWeekday(7).format("ddd"));break;case"mon":i.text(moment().isoWeekday(1).format("ddd"));break;case"tue":i.text(moment().isoWeekday(2).format("ddd"));break;case"wed":i.text(moment().isoWeekday(3).format("ddd"));break;case"thu":i.text(moment().isoWeekday(4).format("ddd"));break;case"fri":i.text(moment().isoWeekday(5).format("ddd"));break;case"sat":i.text(moment().isoWeekday(6).format("ddd"))}})}}})},vems.home.calendarButtonClicked=!1,vems.home.buildCalendar=function(){$("#bookings-monthly-calendar").dxCalendar({value:new Date,min:new Date(1990,0,1),max:new Date(2150,0,1),height:"400px",width:"100%",cellTemplate:function(n,t,i){var f=new Date($(i).data("value")),r=$("<div>").addClass("calendar-cell-container"),e,u,o;return(f.getDay()===6||f.getDay()===0)&&r.addClass("calendar-cell-weekend"),r.append($("<div>").addClass("calendar-cell-text").text(n.text)),e=0,!isNaN(n.text)&&vems.home.bookingCounts&&vems.home.bookingCounts.EventCounts&&(u=$.grep(vems.home.bookingCounts.EventCounts,function(n){return moment(n.Date).isSame(f)&&n.ReserveType!==3}),u&&u.length>0&&(o=0,$.each(u,function(n,t){o+=t.BookingCount}),e=o*5),r.append($("<div>").addClass("calendar-cell-gauge").height(e))),r},onOptionChanged:function(n){n.name==="currentDate"&&vems.home.getBookingCounts(new Date(n.value))},onValueChanged:function(n){if(vems.home.calendarButtonClicked)return vems.home.calendarButtonClicked=!1,!0;$("#my-bookings-tabs a:first").tab("show"),getEventsForDay(new Date(n.value))}}),$("#bookings-monthly-calendar .dx-calendar-cell").has(".calendar-cell-weekend").css("background-color","#F2F2EA");$("#bookings-monthly-calendar").on("dxswipeend",function(){var t=$(this),i=t.data("dxCalendar")._newDate;t.data("dxCalendar")._options.value=i,vems.home.viewModels.myBookings.localeDate(moment(i).format("MMMM YYYY"))});$("#bookings-monthly-calendar").on("click",".dx-calendar-selected-date",function(){var n=$("#bookings-monthly-calendar").data("dxCalendar").option("value");$("#my-bookings-tabs a:first").tab("show"),getEventsForDay(n)})},vems.home.buildEventPieChart=function(n,t){var r=[],i=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),u=0,l=function(n){return $.grep(r,function(t){return t.reserveType===n})},f,e,o,s,h,c;t==="day"?($.each(vems.home.bookingCounts.EventCounts,function(n,t){var e=new Date(moment(t.Date.split("T")[0]).format()),f;moment(e).isSame(i)&&(f=$.grep(r,function(n){return n.reserveType===t.ReserveType}),f.length===0?r.push({reserveType:t.ReserveType,bookingCount:t.BookingCount}):f[0].bookingCount=f[0].bookingCount+t.BookingCount,u+=t.BookingCount)}),$("#day-chart-count").text(u),f=i,e=i):t==="week"?(o=new Date(i.setDate(i.getDate()-i.getDay())),s=new Date(i.setDate(i.getDate()-i.getDay()+6)),$.each(vems.home.bookingCounts.EventCounts,function(n,t){var f=new Date(moment(t.Date.split("T")[0]).format()),i;f>=o&&f<=s&&(i=l(t.ReserveType),i&&i.length>0?i[0].bookingCount+=t.BookingCount:r.push({reserveType:t.ReserveType,bookingCount:t.BookingCount}),u+=t.BookingCount)}),$("#week-chart-count").text(u),f=o,e=s):t==="month"&&(h=new Date(i.getFullYear(),i.getMonth(),1),c=new Date(i.getFullYear(),i.getMonth()+1,0),$.each(vems.home.bookingCounts.EventCounts,function(n,t){var f=new Date(moment(t.Date.split("T")[0]).format()),i;f>=h&&f<=c&&(i=l(t.ReserveType),i&&i.length>0?i[0].bookingCount+=t.BookingCount:r.push({reserveType:t.ReserveType,bookingCount:t.BookingCount}),u+=t.BookingCount)}),$("#month-chart-count").text(u),f=h,e=c),$.each(r,function(n,t){switch(t.reserveType){case 0:t.typeLabel=vems.home.bookingCounts.ReservedLabel;break;case 1:t.typeLabel=vems.home.bookingCounts.RequestedLabel;break;case 2:t.typeLabel=vems.home.bookingCounts.ConflictingLabel;break;case 3:t.typeLabel=vems.home.bookingCounts.CancelledLabel}}),r=r.sort(function(n,t){var i=parseInt(n.reserveType,10),r=parseInt(t.reserveType,10);return i<r?-1:i===r?0:i>r?1:void 0}),$(n).dxPieChart({dataSource:r,legend:{horizontalAlignment:"right",verticalAlignment:"top",font:{family:'"Open Sans", sans-serif'},customizeText:function(n){for(var t=0;t<r.length;t++)if(r[t].typeLabel===n.pointName)return r[t].bookingCount+" "+n.pointName}},series:[{argumentField:"typeLabel",valueField:"bookingCount",label:{visible:!1,position:"inside"},hoverStyle:{hatching:{direction:"none"}}}],tooltip:{enabled:!0,font:{family:'"Open Sans", sans-serif'},customizeTooltip:function(n){return{html:"<div>"+n.value+" "+n.argument+" ("+n.percentText+")<\/div>"}}},customizePoint:function(n){var t="",i="";switch(n.argument){case vems.home.bookingCounts.ReservedLabel:t=vems.home.colorPalette[0],i=vems.home.hoverColorPalette[0];break;case vems.home.bookingCounts.RequestedLabel:t=vems.home.colorPalette[1],i=vems.home.hoverColorPalette[1];break;case vems.home.bookingCounts.ConflictingLabel:t=vems.home.colorPalette[2],i=vems.home.hoverColorPalette[2];break;case vems.home.bookingCounts.CancelledLabel:t=vems.home.colorPalette[3],i=vems.home.hoverColorPalette[3]}return{color:t,hoverStyle:{color:i}}},onPointClick:function(n){function i(n){return n.getFullYear()+"-"+n.getMonth()+1+"-"+n.getDate()}var t;switch(n.target.argument){case vems.home.bookingCounts.ReservedLabel:t=0;break;case vems.home.bookingCounts.RequestedLabel:t=1;break;case vems.home.bookingCounts.ConflictingLabel:t=2;break;case vems.home.bookingCounts.CancelledLabel:t=3;break;default:t=-1}window.location="BrowseReservations.aspx?startdate="+i(f)+"&enddate="+i(e)+"&reservetype="+t},onDone:function(n){n.target&&$.each(n.target._legend._patterns,function(n,t){t.element?$(t.element).remove():$(t.path.element).remove()})}})},vems.home.buildDatePicker=function(){var n=vems.home.viewModels.myBookings.currentDailyDate,t=$("#my-bookings-datepicker").data("DateTimePicker");if(t)t.date(n);else{$("#my-bookings-datepicker").datetimepicker({locale:moment.locale(),defaultDate:n,format:"LL",ignoreReadonly:!0,showTodayButton:!0,showClose:!0,debug:!0,icons:{today:"date-picker-today-btn"},widgetPositioning:{horizontal:"left"}});$("#my-bookings-datepicker").on("dp.change",function(n){n.date.startOf("day").isSame(n.oldDate)||($("#my-bookings-tabs a:first").tab("show"),getEventsForDay(n.date))})}},vems.home.templateVM=function(){var n=this;n.templates=ko.observableArray(vems.webTemplates),n.templateClick=function(n){window.location=n.NavigateUrl}},vems.home.myBookingsVM=function(){var n=this,r=new Date,u=vems.todaysEventsForUser.EventData&&vems.todaysEventsForUser.EventData.length>0?vems.todaysEventsForUser.EventData[0].Events:[];n.localeDate=ko.observable(moment(r).format("LL")),n.events=ko.observableArray(u),n.nextBookingDate=ko.observable(vems.todaysEventsForUser.NextBookingDate),n.userTimeZone=ko.observable(vems.todaysEventsForUser.UserTimeZone),n.userTimeZoneAbbr=ko.observable(vems.todaysEventsForUser.UserTimeZoneAbbr),n.selectedTab=ko.observable($("#my-bookings-tabs").children().index($("#my-bookings-tabs li.active"))),n.cancelReasons=vems.cancelReasons,n.currentDailyDate=moment(r),n.activeBooking=ko.observable(u[0]),n.overflowDate=ko.observable(null),n.gettingEventsForDay=ko.observable(!1),n.getReserveType=function(n,t){var u=moment(r),f=moment(t),i=n;return n===-1?i=6:f.diff(u)<0&&(i=5),vems.home.colorPalette[i]},n.previousTodayNextHandler=function(t){var f=new Date,i,r,u;n.selectedTab()===0?(n.currentDailyDate=t===0?moment(f):n.currentDailyDate.add(t,"Days"),getEventsForDay(n.currentDailyDate)):n.selectedTab()===1&&(vems.home.calendarButtonClicked=!0,i=$("#bookings-monthly-calendar").data("dxCalendar").option("value"),t===0?i=new Date:(r=i.year?i.year():i.getFullYear(),u=i.month?i.month():i.getMonth(),i=new Date(r,u+t,1)),$("#bookings-monthly-calendar").data("dxCalendar").option("value",i),vems.home.viewModels.myBookings.localeDate(moment(i).format("MMMM YYYY")))},n.cancelBooking=function(t,i){n.activeBooking(t);var e=$("#VirtualEmsForm"),u=$("#cancel-modal"),s=$("#cancelBookingBtn",u),o=$(i.target).closest(".row"),h=$(".vc-host-warning",u),c=$(".cal-occ-warning",u),f=$(".reason select",u),r=$(".notes textarea",u),l=!1;if(e.validate(vems.validationClasses),t.RequiresCancelReason){f.rules("add",{required:!0}),r.rules("add",{sanitize:!0}),$("option:selected",f).data().notesRequired&&r.rules("add",{required:!0,trim:!0});f.on("change",function(){$("option:selected",this).data("notes-required")?r.rules("add",{required:!0,trim:!0}):r.rules()&&Object.keys(r.rules()).length>0&&(r.rules("remove","required"),r.rules("remove","trim"),e.data("validator").resetForm())})}h.hide(),c.hide(),t.OccurrenceCount>1&&(t.VideoConferenceHost?h.show():t.IsCalendaringEnabled&&c.show()),u.modal();s.on("click",function(){if(!e.valid())return!1;var i={reservationId:t.ReservationId,bookingId:t.Id,cancelReason:t.RequiresCancelReason?f.val():0,cancelNotes:t.RequiresCancelReason?r.val():""};vems.pageLoading(!0),vems.ajaxPost({url:vems.serverApiUrl()+"/CancelBooking",data:JSON.stringify(i),success:function(n){var i,r;if(vems.pageLoading(!1),i=JSON.parse(n.d),i.Success)l=!0,u.modal("hide"),r=i.SuccessMessage.replace("{0}","<b>"+t.EventName+"<\/b>"),vems.showToasterMessage("",r,"success");else return vems.showErrorToasterMessage(i.ErrorMessage),!1},error:function(){vems.pageLoading(!1)}})});u.on("shown.bs.modal",function(){e.data("validator").resetForm()});u.on("hidden.bs.modal",function(){l&&(o.parents("#my-bookings-daily").length?getEventsForDay(n.currentDailyDate):o.parents("#my-bookings-search").length?n.searchForBookings():o.fadeOut(function(){$(this).remove(),n.events.remove(t),n.events().length===0&&moment(n.nextBookingDate()).diff(moment(t.EventStart))===0&&n.nextBookingDate(null)})),f.length>0&&r.length>0&&(f.val(""),r.val(""),r.rules("remove"),s.off("click"))})},n.endBookingNow=function(n,t){var i=$("#endnow-modal"),u=$("#endBookingBtn",i),f=$(".date",i),e=$(".event-name",i),o=$(".location",i),s=$(t.target).closest("tr"),r;f.html("<strong>"+moment(n.UserEventStart).format("dddd, MMMM Do, YYYY, [from] h:mm [to {0}] A").replace("{0}",moment(n.UserEventEnd).format("h:mm"))+"<\/strong>"),e.text(n.EventName),o.text(n.Building+" - "+n.Room),i.modal(),r={reservationId:n.ReservationId,bookingId:n.Id};u.one("click",function(){vems.ajaxPost({url:vems.serverApiUrl()+"/EndBookingNow",data:JSON.stringify(r),success:function(t){var r=JSON.parse(t.d),u,f,e,o,s,h,c;r.Success?(u=JSON.parse(r.JsonData),f=vems.home.viewModels.myBookings.events(),f.length>0&&(e=$.inArray(n,f),e>=0&&vems.home.viewModels.myBookings.events.splice(e,1,u)),o=vems.home.viewModels.myBookings.searchResults(),o.length>0&&(s=$.inArray(n,o),s>=0&&vems.home.viewModels.myBookings.searchResults.splice(s,1,u)),i.modal("hide"),h=r.SuccessMessage.replace("{0}","<b>"+u.EventName+"<\/b>"),c=vems.showToasterMessage("",h,"success")):vems.showErrorToasterMessage(r.ErrorMessage)}})})},n.checkInToEvent=function(n,t){$(".events-loading-overlay").show(),$(t.target).hide(),vems.ajaxPost({url:vems.serverApiUrl()+"/CheckInToBooking",data:JSON.stringify({bookingId:n.Id}),success:function(n){var t=JSON.parse(n.d),i;t.Success?(i=JSON.parse(t.JsonData),i.IsCheckedIn?vems.showToasterMessage("",t.SuccessMessage,"success"):vems.showErrorToasterMessage(t.ErrorMessage)):vems.showErrorToasterMessage(t.ErrorMessage),getEventsForDay(vems.home.viewModels.myBookings.currentDailyDate)}})},n.searchForBookings=function(){$("#booking-search-instructions").hide(),$("#booking-search-results").show(),$("#booking-search-count").show();var t=$("#booking-search-box").val();vems.ajaxPost({url:vems.serverApiUrl()+"/searchForBookings",data:JSON.stringify({searchText:t}),success:function(i){var r=JSON.parse(i.d);n.searchResults(r.EventData[0].Events),f(),n.searchRecordCount()===0?($("#booking-no-results-head").text(vems.decodeHtml(vems.screenText.NoSearchResults.replace("{0}",t))),$("#booking-no-results").show(),$("#booking-search-results").hide()):($("#booking-no-results").hide(),$("#booking-search-results").show())},error:function(n,t,i){return console.log(i),!1}})},n.searchResults=ko.observableArray(),n.searchRecordCount=ko.pureComputed(function(){return n.searchResults().length}),n.searchRecordCountLabel=ko.pureComputed(function(){return n.searchResults().length===1?n.searchResults().length+" "+vems.decodeHtml(vems.screenText.Result):n.searchResults().length+" "+vems.decodeHtml(vems.screenText.Results)});var t="EventStart",i="ASC",f=function(){var r=function(n,r){return n[t]<r[t]?i=="ASC"?-1:1:n[t]>r[t]?i=="ASC"?1:-1:0};n.searchResults.sort(r)};n.sortSearchResults=function(n,r){var e=$(r.target),u=$(r.target).find("i");switch($(r.target).attr("id")){case"booking-search-header-title":t="EventName";break;case"booking-search-header-location":t="Location";break;case"booking-search-header-date":t="EventStart"}u.length>0?u.eq(0).hasClass("fa-angle-up")?(i="DES",u.eq(0).removeClass("fa-angle-up").addClass("fa-angle-down")):(i="ASC",u.eq(0).removeClass("fa-angle-down").addClass("fa-angle-up")):(i="ASC",$("#booking-search-sort-indicator").remove(),$("<i id='booking-search-sort-indicator' class='fa fa-angle-up'><\/i>").appendTo(e)),f()},n.showMap=function(n){var t=ko.mapping.fromJS(n),i=buildFloorMapRoomInfo(t);return vems.floorPlanModalVM.buildModalMapForRoom(i),!1},n.hideShowMyBookingsButton=function(){return $("#my-reservations-overlay").fadeOut(),n.previousTodayNextHandler(0),!1};$("#my-bookings-tabs").on("show.bs.tab",function(t){n.selectedTab($(this).children().index($(t.target).parent()))})};$(document).on("click","#my-bookings-search-tab a",function(){setTimeout(function(){$("#booking-search-box")[0].focus()},500)});vems=vems||{},vems.templateModalShowing=function(n){var t=$(n.relatedTarget),i=t.data("navigateurl"),r=t.data("templateid");$(n.target).on("click","#bookNowBtn",function(){window.location=i});vems.ajaxPost({url:vems.serverApiUrl()+"/ReservationTemplate",data:"{ id: "+r+" }",success:function(n){typeof ko.dataFor($("#template-modal-content")[0])=="undefined"?(vems.templateVM=ko.mapping.fromJS(JSON.parse(n.d)),ko.applyBindings(vems.templateVM,$("#template-modal-content")[0])):(typeof vems.templateVM=="undefined"?vems.templateVM=ko.mapping.fromJS(JSON.parse(n.d)):ko.mapping.fromJS(JSON.parse(n.d),vems.templateVM),$("#template-modal-tabs li:first-child").tab("show"),$("#template-modal-tab-content div").removeClass("active"),$("#template-modal-tab-content div:first-child").addClass("active"))},error:function(n,t,i){return console.log(i),!1}})},function(n){function c(c,l){o=this,f=n.extend({},n.fn.calendarScroller.defaults,l),n.extend(o,{init:function(){n(i).find(".calendar-scroller-container").remove(),t=f.startDate?moment(f.startDate):moment(new Date),t.hour(0).minute(0).second(0).millisecond(0),e=moment(t).add(-t.weekday(),"day"),i.append(u.drawContainer());n(i).on("click",".week-date-right",function(){if(!r){r=!0;var t=n(".scroller-day-container.center");s.animateDays(t,-t.width())}});n(i).on("click",".week-date-left",function(){if(!r){r=!0;var t=n(".scroller-day-container.center");s.animateDays(t,t.width())}});var c=new Hammer(document.getElementsByClassName("calendar-scroller-cal")[0]);c.on("tap",function(i){if(!r){r=!0;var f=n(i.srcEvent.srcElement).hasClass("calendar-scroller-day")?n(i.srcEvent.srcElement):n(i.srcEvent.srcElement).parent();t=moment(f.data("date")),u.setSelectedDateStyle()}});c.on("swipe",function(t){if(!r){r=!0;var i=n(".scroller-day-container.center");t.deltaX>0?s.animateDays(i,i.width()):s.animateDays(i,-i.width())}});return u.setSelectedDateStyle(),o.bookingsChanged(),h=!1,this},bookingsChanged:function(t){t!=undefined&&(f.eventDates=t),n.each(f.eventDates,function(t,i){n('.calendar-scroller-day[data-date="'+moment(i)+'"]').addClass("has-events")})},setDate:function(n){f.startDate=moment(n).hour(0).minute(0).second(0).millisecond(0),o.init()},setLock:function(n){r=!!n}})}function l(i){i>=0?(n(".scroller-day-container.right").remove(),n(".scroller-day-container.center").addClass("right").removeClass("center"),n(".scroller-day-container.left").addClass("center").removeClass("left"),e.add(-7,"days"),t.add(-7,"days"),n(".week-date").text(u.getWeekLongDescription()),n(".calendar-scroller-cal-scroll").append(u.buildDaysRow(moment(e).add(-7,"days"),"left"))):(n(".scroller-day-container.left").remove(),n(".scroller-day-container.center").addClass("left").removeClass("center"),n(".scroller-day-container.right").addClass("center").removeClass("right"),e.add(7,"days"),t.add(7,"days"),n(".week-date").text(u.getWeekLongDescription()),n(".calendar-scroller-cal-scroll").prepend(u.buildDaysRow(moment(e).add(7,"days"),"right"))),u.setSelectedDateStyle()}var o,i,f,h=!0,t,e,r=!1,u,s;n.fn.calendarScroller=function(t){o=this,i=this;var f,u=i.data("ems_calendarScroller"),r;if(typeof t=="string"){updateOptions(t,arguments[1],u);return}return u?u:(this.each(function(){var f=new c(n(this),t),u;f.init(),u=i.data("ems_calendarScroller",f),r=r?r.add(u):u}),o.removeInstance=function(t){if(r.length>1){var f=1,u=n.inArray(t,r);u>-1&&r.splice(u,1)}else r=null,i.empty(),i.unbind().removeData()},r?r:o)},u={drawContainer:function(){var t=n('<div class="calendar-scroller-container">'),i=n('<div class="calendar-scroller-date">').appendTo(t),r=n('<div class="calendar-scroller-cal">').appendTo(t);return this.setDateControl(i),this.setCalendar(r),t},setDateControl:function(n){n.append('<div class="week-date-left"><button type="button" class="btn"><i class="fa fa-chevron-left"><\/i><\/button><\/div>'),n.append('<div class="week-date">'+this.getWeekLongDescription()+"<\/div>"),n.append('<div class="week-date-right"><button type="button" class="btn"><i class="fa fa-chevron-right"><\/i><\/button><\/div>')},setCalendar:function(t){var r=moment(e),u=moment(new Date(r)).add(-7,"days"),f=moment(new Date(r)).add(7,"days"),i=n('<div class="calendar-scroller-cal-scroll">');i.append(this.buildDaysRow(u,"left")),i.append(this.buildDaysRow(r,"center")),i.append(this.buildDaysRow(f,"right")),i.appendTo(t)},getWeekLongDescription:function(){var n=moment(e),t=moment(e).add(6,"day");return n.format("ll")+" - "+t.format("ll")},setSelectedDateStyle:function(){moment.isMoment(t)||(t=moment(t)),t=moment(new Date(t.year(),t.month(),t.date(),0,0,0)),n(".calendar-scroller-day").removeClass("selected"),n('.calendar-scroller-day[data-date="'+t+'"]').addClass("selected"),n.isFunction(f.dateSelected)&&!h&&f.dateSelected(t)},buildDaysRow:function(t,i){for(var f=n('<div class="scroller-day-container '+i+'">'),u,e,r=0;r<7;r++)u=moment(t).add(r,"day"),e=n('<div class="calendar-scroller-day" data-date="'+u+'"><div class="day">'+u.format("ddd")+'<\/div><div class="date">'+u.format("D")+'<\/div><div class="event-indicator"><i class="fa fa-circle"><\/i><\/div><\/div>'),f.append(e);return f}},s={animateDays:function(t,i){n(t).animate({left:i},{duration:500,step:function(t){i>=0?(n(".scroller-day-container.right").hide(),n(".scroller-day-container.left").show(),n(".scroller-day-container.left").css("left",t-n(this).width())):(n(".scroller-day-container.left").hide(),n(".scroller-day-container.right").show(),n(".scroller-day-container.right").css("left",t+n(this).width()))},complete:function(){l(i)}})}},n.fn.calendarScroller.defaults={startDate:null,dateSelected:function(){}}}(jQuery)